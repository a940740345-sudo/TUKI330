<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes"
    />
    <title>EPhone PWA</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="apple-touch-icon"
      href="https://i.postimg.cc/Fz25WLbr/7D99384EE38C42D2BA98F53E4582FEA8.jpg"
    />
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="EPhone" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link
      rel="icon"
      type="image/png"
      href="https://i.postimg.cc/Fz25WLbr/7D99384EE38C42D2BA98F53E4582FEA8.jpg"
    />
    <meta name="theme-color" content="#f0f2f5" />

    <style>
      /* --- æ ¸å¿ƒé…è‰²ï¼šèœ‚èœœé»„æ²¹ & ç„¦ç³–å¤å¤ --- */
      :root {
        --bg-color: #fdfbf7; /* æš–ç±³ç™½ */
        --glass-base: rgba(255, 253, 240, 0.65); /* å¥¶æ²¹åº•è‰²ç»ç’ƒ */
        --border-color: #efe6d5; /* æŸ”å’Œçš„è¾¹æ¡†è‰² */
        --accent-gold: #e6ceac; /* å¤å¤é‡‘ */
        --text-brown: #8d6e63; /* ç„¦ç³–æ£•è‰²å­— */
        --text-deep: #5d4037; /* æ·±å’–å•¡è‰²å­— */
        --shadow-warm: 0 15px 30px rgba(210, 180, 140, 0.25); /* æš–æ£•è‰²æŠ•å½± */
        --font-main: 'Courier New', Courier, monospace; /* å¤å¤æ‰“å­—æœºå­—ä½“ */
      }

      html {
        height: 100%;
        -webkit-text-size-adjust: 100%;
      }
      body {
        margin: 0;
        font-family: var(--font-main);
        font-weight: bold;
        height: 100%;
        overflow: hidden;
        background-color: var(--bg-color);
        /* èƒŒæ™¯ï¼šææ·¡çš„å¤å¤æ ¼å­ */
        background-image: linear-gradient(rgba(230, 206, 172, 0.2) 1px, transparent 1px),
          linear-gradient(90deg, rgba(230, 206, 172, 0.2) 1px, transparent 1px);
        background-size: 40px 40px;
        color: var(--text-brown);
      }

      #phone-screen {
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }
      .screen {
        width: 100%;
        height: 100%;
        position: absolute;
        display: flex;
        flex-direction: column;
        transition: 0.3s;
      }
      #home-screen {
        padding-top: calc(30px + env(safe-area-inset-top));
        padding-bottom: 20px;
        box-sizing: border-box;
        z-index: 10;
      }
      #home-screen-pages-container {
        flex-grow: 1;
        width: 100%;
        height: 100%;
        position: relative;
      }
      #home-screen-pages {
        width: 100%;
        height: 100%;
        display: flex;
      }
      .home-screen-page {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #main-content-area {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* --- æ’­æ”¾å™¨ä¸»ä½“ï¼šç²¾è‡´çš„å¥¶æ²¹æ–¹ç³– --- */
      #desktop-layout {
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 0 15px;
        box-sizing: border-box;
      }

      #desktop-app-container {
        /* å®ä½“å¥¶æ²¹å¡‘æ–™è´¨æ„Ÿ */
        background: linear-gradient(to bottom, #fdfbf7 0%, #f4eadd 100%);
        /* å¡‘æ–™çš„åšå®è¾¹æ¡† */
        border: 1px solid #e0d0b8;
        /* æ¨¡æ‹Ÿå¡‘æ–™æ³¨å¡‘çš„åœ†æ¶¦æ„Ÿ */
        border-radius: 20px;
        /* ç¨å¾®å®½ä¸€ç‚¹ï¼Œç»™ç£å¸¦ç•™ç©ºé—´ */
        padding: 50px 35px 60px 35px;
        display: flex;
        gap: 35px; /* æ‹‰å¤§ä¸¤ä¸ªå·è½´çš„è·ç¦» */
        position: relative;
        /* ç«‹ä½“æŠ•å½±ï¼šåƒæ”¾åœ¨æ¡Œé¢ä¸Šä¸€æ · */
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8), /* é¡¶éƒ¨é«˜å…‰ */ inset 0 -3px 5px rgba(0, 0, 0, 0.05),
          /* åº•éƒ¨é˜´å½± */ 0 15px 35px rgba(141, 110, 99, 0.25), /* æ¡Œé¢æŠ•å½± */ 0 5px 10px rgba(0, 0, 0, 0.05);
        align-items: center;
        justify-content: center;
        min-width: 320px;
      }

      /* é¡¶éƒ¨é“­ç‰Œï¼šEPHONE MIX (å¤å¤é‡‘å±ç‰Œé£æ ¼) */
      #desktop-app-container::before {
        content: 'EPHONE MIX';
        position: absolute;
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 11px;
        font-family: Helvetica, Arial, sans-serif; /* é“­ç‰Œç”¨æ— è¡¬çº¿ä½“æ˜¾å¾—æ›´å·¥ä¸šå¤å¤ */
        color: #a1887f; /* æµ…å’–è‰²å­— */

        /* é“­ç‰ŒèƒŒæ™¯ï¼šåšæˆå‡¹è¿›å»çš„æµ…é‡‘è‰² */
        background: linear-gradient(to bottom, #fffcf5, #f1e9d2);
        padding: 4px 16px;
        border-radius: 4px;
        letter-spacing: 2px;
        font-weight: 900;

        /* é“­ç‰Œçš„ç«‹ä½“æ„Ÿ */
        border: 1px solid #d7ccc8;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05), 0 1px 0 #fff;
        z-index: 10;
      }

      /* èºä¸é’‰ï¼šå¤å¤é»„é“œè‰² */
      .screw {
        position: absolute;
        width: 9px;
        height: 9px;
        background: linear-gradient(135deg, #e6ceac, #bf9e74); /* é‡‘å±å…‰æ³½ */
        border-radius: 50%;
        box-shadow: inset 1px 1px 2px rgba(255, 255, 255, 0.8), 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      /* ç»™èºä¸åŠ ä¸ªå°ä¸€å­—æ§½ï¼Œå¢åŠ ç²¾è‡´åº¦ */
      .screw::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 5px;
        height: 1px;
        background: rgba(93, 64, 55, 0.3);
      }

      .screw.tl {
        top: 12px;
        left: 12px;
      }
      .screw.tr {
        top: 12px;
        right: 12px;
      }
      .screw.bl {
        bottom: 12px;
        left: 12px;
      }
      .screw.br {
        bottom: 12px;
        right: 12px;
      }
      .tape-window-bg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 240px; /* å˜å®½ï¼Œè¿æ¥ä¸¤ä¸ªå·è½´ */
        height: 90px;
        /* è´´çº¸è´¨æ„Ÿï¼šç±³é»„è‰² */
        background: #fffdf5;
        /* è´´çº¸è¾¹æ¡† */
        border: 2px solid #e6ceac;
        border-radius: 35px; /* å˜æˆèƒ¶å›Šå½¢çŠ¶ */
        z-index: 0;
        /* å†…éƒ¨çº¹ç†ï¼šæ¨ªçº¿ï¼Œåƒå¯ä»¥å†™å­—çš„åœ°æ–¹ */
        background-image: repeating-linear-gradient(transparent, transparent 19px, #f2e6d9 20px);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      /* --- å›¾æ ‡éƒ¨åˆ† --- */
      .desktop-app-icon {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        width: 85px;
        -webkit-tap-highlight-color: transparent;
      }

      /* --- 1. ç£å¸¦å·è½´åŠ¨ç”»ä¸è´¨æ„Ÿ --- */

      /* å®šä¹‰æ—‹è½¬åŠ¨ç”» */
      @keyframes reel-spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .icon-bg-desktop {
        width: 76px;
        height: 76px;
        border-radius: 50%;
        /* å·è½´èƒŒæ™¯ï¼šæ·±è‰² */
        background: #3e2723;
        /* å…³é”®ï¼šé½¿è½®è¾¹æ¡†æ•ˆæœ */
        border: 4px dashed #d7ccc8;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5), /* å†…éƒ¨æ·±é‚ƒæ„Ÿ */ 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        transition: transform 0.3s;
        position: relative;
      }
      /* ç»™å›¾ç‰‡ä¸€ç‚¹å†…ç¼©ï¼Œéœ²å‡ºé½¿è½® */
      .icon-bg-desktop img {
        width: 86%;
        height: 86%;
        object-fit: cover;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: reel-spin 10s linear infinite;
        opacity: 0.95;
      }
      /* ç£å¸¦åº•éƒ¨çš„æ¢¯å½¢åŒºåŸŸ */
      .tape-bottom-deco {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 220px;
        height: 35px;
        /* é¢œè‰²ç¨å¾®æ·±ä¸€ç‚¹ï¼Œæ¨¡æ‹Ÿç£å¸¦ä¸‹åŠéƒ¨åˆ† */
        background: #f0e6d2;
        /* åšæˆæ¢¯å½¢æ•ˆæœ */
        clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
        border-top: 1px solid #e0d0b8;
        z-index: 5;
      }

      /* è£…é¥°æ€§çš„å°å­” */
      .tape-holes {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 12px;
        display: flex;
        justify-content: space-between;
      }
      .tape-holes::before,
      .tape-holes::after {
        content: '';
        width: 12px;
        height: 12px;
        background: #5d4037; /* æ·±å­”é¢œè‰² */
        border-radius: 50%;
        box-shadow: inset 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      /* å›¾ç‰‡åº”ç”¨æ—‹è½¬åŠ¨ç”» */
      .icon-bg-desktop img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        /* è¿™é‡Œæ·»åŠ åŠ¨ç”»ï¼š10ç§’è½¬ä¸€åœˆï¼Œçº¿æ€§æ— é™å¾ªç¯ */
        animation: reel-spin 10s linear infinite;
        opacity: 0.9; /* ç¨å¾®é€æ˜ä¸€ç‚¹æ›´æœ‰å¤å¤æ„Ÿ */
      }

      /* ç»™å·è½´åŠ ä¸€ä¸ªä¸­å¿ƒè½´è£…é¥°ï¼Œçœ‹èµ·æ¥æ›´åƒç£å¸¦ */
      .icon-bg-desktop::after {
        content: '';
        position: absolute;
        width: 12px;
        height: 12px;
        background: #fff;
        border-radius: 50%;
        z-index: 5;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }
      .icon-bg-desktop img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      /* æ ‡ç­¾ï¼šå¤å¤æ‰“å­—æœºçº¸æ¡ */
      .desktop-app-icon .label {
        font-size: 12px;
        color: var(--text-deep);
        /* ç±³é»„è‰²çº¸å¼ æ„Ÿ */
        background: #fffdf0;
        padding: 3px 8px;
        border: 1px solid #efe6d5;
        border-radius: 2px; /* å‡ ä¹ç›´è§’ */
        box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05);
        font-weight: bold;
        transform: rotate(-2deg); /* å¾®å¾®æ­ª */
      }
      .desktop-app-icon:last-child .label {
        transform: rotate(1deg);
      }

      .desktop-app-icon:active .icon-bg-desktop {
        transform: scale(0.92);
      }

      /* App çª—å£ */
      .app-window {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: #fff;
        z-index: 50;
        display: none;
        flex-direction: column;
        opacity: 0;
        transform: scale(0.95);
        transition: 0.3s;
      }
      .app-window.active {
        display: flex;
        opacity: 1;
        transform: scale(1);
      }
      .app-iframe {
        width: 100%;
        height: 100%;
        border: none;
        background: #fff;
      }

      /* --- å³ä¸‹è§’å”±ç‰‡æŒ‰é’®ï¼šèœ‚èœœé»„èƒ¶ --- */
      #fab-container {
        position: fixed;
        bottom: 50px;
        right: 25px;
        z-index: 1000;
        width: 64px;
        height: 64px;
      }

      #fab-main {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        /* ä¿®æ”¹é¢œè‰²ï¼šä½¿ç”¨æ›´æŸ”å’Œçš„å¤å¤é‡‘è‰² */
        background-color: #eecfa1;

        /* ä¿®æ”¹çº¹ç†ï¼šè®©çº¹ç†å¯¹æ¯”åº¦ä½ä¸€ç‚¹ï¼Œæ›´ç²¾è‡´ */
        background-image: repeating-radial-gradient(
          #eecfa1 0,
          #eecfa1 2px,
          #e0b878 3px,
          /* ç¨å¾®æ·±ä¸€ç‚¹çš„é‡‘ */ #eecfa1 4px
        );

        /* é˜´å½±ç¨å¾®åŠ æ·±ä¸€ç‚¹ */
        box-shadow: 0 0 0 3px #fff, 0 6px 15px rgba(161, 136, 127, 0.4);
        box-shadow: 0 0 0 3px #fff, 0 6px 15px rgba(251, 192, 45, 0.3);
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: 0.4s;
        position: relative;
      }

      /* ä¸­é—´æ ‡ç­¾ */
      #fab-main::before {
        content: '';
        position: absolute;
        width: 26px;
        height: 26px;
        background: #fff8e1; /* å¥¶ç™½è‰²æ ‡ç­¾ */
        border-radius: 50%;
        z-index: 1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      /* ä¸­é—´å­” */
      #fab-main::after {
        content: '';
        position: absolute;
        width: 6px;
        height: 6px;
        background: var(--text-deep);
        border-radius: 50%;
        z-index: 2;
      }
      #fab-main svg {
        width: 18px;
        height: 18px;
        fill: var(--text-deep);
        z-index: 3;
        position: relative;
        transition: 0.3s;
      }

      #fab-main:active {
        transform: rotate(15deg) scale(0.95);
      }
      #fab-main.expanded {
        transform: rotate(90deg);
        background: #fff;
        background-image: none;
      }
      #fab-main.expanded::before,
      #fab-main.expanded::after {
        opacity: 0;
      }

      /* èœå• */
      .fab-actions {
        position: absolute;
        bottom: 80px;
        right: 0;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 12px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(15px);
        transition: 0.3s;
        pointer-events: none;
        width: max-content;
      }
      #fab-container.menu-open .fab-actions {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        pointer-events: auto;
      }

      .fab-mini-btn {
        width: 44px;
        height: 44px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: var(--text-brown);
        font-size: 14px;
        border: 1px solid #f0f0f0;
        padding: 0; /* å»æ‰å†…è¾¹è· */
        overflow: hidden; /* ç¡®ä¿å›¾ç‰‡ä¸æº¢å‡º */
        background: #fff;
      }
      /* å›¾ç‰‡å¡«æ»¡æŒ‰é’® */
      .fab-mini-btn img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* SVG å›¾æ ‡å¤§å°é€‚é… */
      .fab-mini-btn svg {
        width: 20px;
        height: 20px;
        fill: var(--text-deep); /* ä½¿ç”¨æ·±æ£•è‰²å¡«å…… */
      }
      .fab-label {
        background: #fff;
        color: var(--text-deep);
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        margin-right: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        font-weight: bold;
      }

      /* éšèº«æ¨¡å¼ */
      #fab-container.ghost-mode {
        opacity: 0; /* å®Œå…¨é€æ˜ï¼Œçœ‹ä¸è§ */
        pointer-events: none; /* é¼ æ ‡ç©¿é€ï¼Œç‚¹ä¸åˆ°åŸä½ç½® */
      }

      #fab-container.ghost-mode .fab-actions {
        display: none;
      }

      /* Toast */
      #toast-msg {
        position: fixed;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        background: var(--text-deep);
        color: #fff;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 13px;
        opacity: 0;
        visibility: hidden;
        transition: 0.3s;
        z-index: 2000;
      }
      #toast-msg.show {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
      }

      /* â˜…â˜…â˜…â˜…â˜… è¿™é‡Œæ˜¯ä½ è¦å¤åˆ¶è¿›å»çš„ä»£ç  å¼€å§‹ â˜…â˜…â˜…â˜…â˜… */
      /* è¾¹ç¼˜æ„Ÿåº”å±‚æ ·å¼ */
      .edge-sensor {
        position: fixed;
        z-index: 1500; /* å¿…é¡»æ¯”Appé«˜ */
        background: transparent; /* é€æ˜çœ‹ä¸è§ */
      }
      /* é¡¶éƒ¨æ„Ÿåº”æ¡ */
      .edge-sensor.top { top: 0; left: 0; width: 100%; height: 30px; }
      /* åº•éƒ¨æ„Ÿåº”æ¡ */
      .edge-sensor.bottom { bottom: 0; left: 0; width: 100%; height: 30px; }
      /* å·¦ä¾§æ„Ÿåº”æ¡ */
      .edge-sensor.left { top: 30px; bottom: 30px; left: 0; width: 15px; }
      /* å³ä¾§æ„Ÿåº”æ¡ */
      .edge-sensor.right { top: 30px; bottom: 30px; right: 0; width: 15px; }
      /* â˜…â˜…â˜…â˜…â˜… è¿™é‡Œæ˜¯ä½ è¦å¤åˆ¶è¿›å»çš„ä»£ç  ç»“æŸ â˜…â˜…â˜…â˜…â˜… */
/* ===========================
         AIç»ˆç«¯ 5.0 ç»ˆæç‰ˆæ ·å¼
         =========================== */
      
      /* 1. ä¿®å¤åˆ˜æµ·å± & å®¹å™¨ä¼˜åŒ– */
      .schedule-container { padding: 60px 20px 120px 20px; height: 100%; overflow-y: auto; box-sizing: border-box; }
      .schedule-header { font-size: 20px; color: #5d4037; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px dashed #e6ceac; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }

      /* 2. ç»Ÿä¸€æ¡Œé¢å›¾æ ‡å¤§å° */
      .icon-bg-desktop svg { width: 50%; height: 50%; fill: #eceff1; }
      .icon-bg-desktop span { font-size: 28px; }

     /* 3. å…¨æ–°å¯æ‹–åŠ¨é«˜çº§æ‚¬æµ®çª— */
#flow-widget {
  position: fixed;
  top: 120px;
  right: 20px;
  z-index: 9999;
  display: none;
  cursor: move;
  user-select: none;
  min-width: 80px;
  max-width: 300px;
  transition: opacity 0.4s, transform 0.2s;
}

/* è¯¦ç»†æ–‡å­—æ¨¡å¼ï¼ˆå•è¡Œæ»šåŠ¨ï¼‰ */
.flow-card {
  background: rgba(60, 60, 60, 0.55);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-radius: 14px;
  padding: 10px 14px;
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  line-height: 1.4;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  overflow: hidden;
  white-space: nowrap;
  text-overflow: clip;
  animation: flow-scroll 12s linear infinite paused;
}
.flow-card.scrolling { animation-play-state: running; }

@keyframes flow-scroll {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* ä¸å‰§é€æ¨¡å¼ï¼ˆå‘¼å¸é—ªçƒè½®æ’­ï¼‰ */
.flow-breath {
  background: rgba(60, 60, 60, 0.55);
  backdrop-filter: blur(12px);
  border-radius: 14px;
  padding: 10px 14px;
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  text-align: center;
  animation: breath 3s ease-in-out infinite;
}
@keyframes breath {
  { 0%,100% { opacity: 0.6; } 50% { opacity: 1; } }

/* çº¯å›¾æ ‡æ¨¡å¼ */
.flow-icon-img {
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  animation: float-y 4s ease-in-out infinite;
}
      /* 4. è®¾ç½®é¢æ¿ç»„ä»¶ */
      .settings-group { margin-bottom: 20px; background: rgba(255, 255, 255, 0.5); padding: 15px; border-radius: 12px; border: 1px solid #efe6d5; }
      .settings-title { font-size: 14px; color: #8d6e63; margin-bottom: 10px; font-weight: bold; border-left: 3px solid #e6ceac; padding-left: 8px; display: flex; justify-content: space-between; align-items: center;}
      .input-row { margin-bottom: 10px; }
      .input-label { font-size: 12px; color: #5d4037; margin-bottom: 4px; display: block; }
      .custom-input, .custom-textarea { width: 100%; padding: 8px; border: 1px solid #e0d0b8; border-radius: 6px; background: #fffdf5; font-size: 13px; color: #3e2723; box-sizing: border-box; outline: none; transition: 0.3s;}
      .custom-input:focus, .custom-textarea:focus { background: #fff; border-color: #8d6e63; }
      .custom-textarea { resize: vertical; min-height: 60px; font-family: monospace; }
      
      .btn-row { display: flex; gap: 10px; margin-top: 10px; }
      .btn-primary { flex: 1; background: #eecfa1; color: #5d4037; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
      .btn-secondary { flex: 1; background: #fff; border: 1px solid #d7ccc8; color: #8d6e63; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
      .icon-btn { width: 30px; height: 30px; border: 1px solid #d7ccc8; background: #fff; border-radius: 4px; cursor: pointer; display: flex; justify-content: center; align-items: center; color: #8d6e63; font-size: 14px; padding:0; }
      
      .preset-bar { display: flex; gap: 8px; margin-bottom: 10px; background: #fffdf5; padding: 8px; border-radius: 8px; border: 1px dashed #d7ccc8; align-items: center; }
      .preset-select { flex: 1; padding: 6px; border: 1px solid #e0d0b8; border-radius: 4px; background: #fff; font-size: 12px; color: #5d4037; }
      
      /* è§’è‰²ä¸é¡µç­¾æ  */
      .role-bar { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; background: #efe6d5; padding: 8px; border-radius: 8px; }
      .mini-btn { width: 24px; height: 24px; border: 1px solid #d7ccc8; background: #fff; border-radius: 4px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #8d6e63; font-size: 12px; }
      .tabs-header { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; border-bottom: 1px solid #efe6d5; }
      .tab-item { padding: 6px 12px; background: #fff; border: 1px solid #e0d0b8; border-radius: 6px 6px 0 0; font-size: 12px; color: #8d6e63; cursor: pointer; white-space: nowrap; }
      .tab-item.active { background: #eecfa1; color: #5d4037; font-weight: bold; border-bottom: 1px solid #eecfa1; }
      .tab-add-btn { padding: 6px 10px; background: #efe6d5; border: 1px dashed #bbb; border-radius: 6px; cursor: pointer; color: #5d4037; }

      /* å¯¼å‡ºä¸å¼€å…³ */
      .export-control-panel { background: #fff3e0; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ffcc80; }
      .export-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; font-size: 12px; color: #e65100; }
      .toggle-switch { position: relative; display: inline-block; width: 34px; height: 20px; }
      .toggle-switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
      .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
      input:checked + .slider { background-color: #ff9800; }
      input:checked + .slider:before { transform: translateX(14px); }

      /* æç¤ºè¯å·¥åŠ */
      .prompt-toolbar { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 8px; padding: 5px; background: #efe6d5; border-radius: 6px; }
      .var-btn { background: #fff; border: 1px solid #d7ccc8; border-radius: 4px; padding: 2px 6px; font-size: 10px; color: #5d4037; cursor: pointer; font-family: monospace; }

      /* å®æ—¶é¢æ¿ & å¡ç‰‡ */
      #realtime-status-panel { background: #3e2723; color: #fff; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(62,39,35,0.4); border: 1px solid #5d4037; display: none; }
      .rt-content { font-size: 15px; font-weight: bold; color: #fff8e1; margin: 5px 0; line-height: 1.4; }
      .rt-divider { border: 0; border-top: 1px dashed #8d6e63; margin: 10px 0; }
      .timeline-card { background: #fff; border: 1px solid #efe6d5; border-radius: 12px; padding: 15px; margin-bottom: 15px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.03); transition: 0.3s; }
      .timeline-card.active-now { border: 2px solid #ffb74d; background: #fff3e0; transform: scale(1.02); z-index: 2; box-shadow: 0 8px 20px rgba(255, 183, 77, 0.3); }
      .t-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
      .t-time { font-family: monospace; font-weight: 900; font-size: 16px; color: #5d4037; background: #eecfa1; padding: 2px 8px; border-radius: 4px; }
      .t-desc { font-size: 14px; color: #4e342e; line-height: 1.5; white-space: pre-wrap; }
      .card-actions { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; display: flex; justify-content: flex-end; gap: 10px; }
      .card-btn { font-size: 11px; padding: 4px 8px; border-radius: 4px; cursor: pointer; border: 1px solid transparent; background: transparent; }
      .card-btn.edit { color: #8d6e63; border-color: #d7ccc8; }
      .card-btn.del { color: #e57373; border-color: #ffcdd2; }

      /* å°å‰§åœº (ç”µå½±ç¥¨/å°ç¥¨) */
      .movie-ticket { margin-top: 10px; background: #37474f; color: #eceff1; border-radius: 8px; overflow: hidden; }
      .ticket-header { background: #263238; padding: 8px; font-size: 12px; text-align: center; border-bottom: 1px dashed #546e7a; }
      .ticket-body { padding: 15px; text-align: center; }
      .receipt { margin-top: 10px; background: #fff; padding: 15px; border: 1px solid #eee; font-family: monospace; font-size: 12px; color: #333; position: relative; border-bottom: 2px dashed #ccc; }
      .receipt-header { text-align: center; font-weight: bold; margin-bottom: 10px; border-bottom: 1px dashed #ccc; }
      .receipt ul { list-style: none; padding: 0; }
      .receipt li { display: flex; justify-content: space-between; margin-bottom: 4px; }
      .receipt-total { border-top: 1px dashed #ccc; margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; font-weight: bold;}
      

    </style>
  </head>
  <body>
    <div id="phone-screen">
      <!-- çŠ¶æ€æ  HTML å·²ç§»é™¤ -->

      <!-- ä¸»å±å¹• (Home Screen) -->
      <div id="home-screen" class="screen">
        <div id="home-screen-pages-container">
          <div id="home-screen-pages">
            <div class="home-screen-page">
              <div id="main-content-area">
                <div id="desktop-layout">
                  <div id="desktop-app-container">
                    <!-- è£…é¥°ï¼šå››ä¸ªè§’çš„èºä¸é’‰ -->
                    <div class="screw tl"></div>
                    <div class="screw tr"></div>
                    <div class="screw bl"></div>
                    <div class="screw br"></div>

                    <!-- ã€æ–°å¢ã€‘ç£å¸¦åº•éƒ¨çš„æ¢¯å½¢è£…é¥°ï¼Œæ›´æœ‰ç£å¸¦å‘³ -->
                    <div class="tape-bottom-deco">
                      <div class="tape-holes"></div>
                    </div>

                    <!-- è£…é¥°ï¼šä¸­é—´çš„ç£å¸¦è§†çª—èƒŒæ™¯ -->
                    <div class="tape-window-bg"></div>

                    <!-- å·¦å·è½´ï¼š330 -->
                    <div class="desktop-app-icon" onclick="openApp('app-a')">
                      <div class="icon-bg-desktop">
                        <img
                          src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg"
                          alt="330"
                        />
                      </div>
                      <span class="label">330</span>
                    </div>

                    <!-- å³å·è½´ï¼šå…”K -->
                    <div class="desktop-app-icon" onclick="openApp('app-b')">
                      <div class="icon-bg-desktop">
                        <img
                          src="https://i.postimg.cc/Kj8JnRcp/267611-CC01-F8-A3-B4910-A2-C2-FFDE479-DC.jpg"
                          alt="å…”K"
                        />
                      </div>
                      <span class="label">å…”K</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="app-a" class="app-window app-frame">
        <iframe data-src="https://kittykitty0v0.github.io/sfsfdf/" src="" class="app-iframe"></iframe>
      </div>

      <div id="app-b" class="app-window app-frame">
        <iframe data-src="https://kittykitty0v0.github.io/-k-/" src="" class="app-iframe"></iframe>
      </div>

<div id="flow-widget">
  <div id="flow-content"></div>
</div>
        </div>

      <div id="app-settings" class="app-window app-frame">
        <div class="schedule-container">
          <div class="schedule-header">
            <span>âš™ï¸ ç»ˆç«¯é…ç½®</span>
            <div>
              <button class="icon-btn" onclick="exportData()" title="å¯¼å‡º">ğŸ“¤</button>
              <button class="icon-btn" onclick="document.getElementById('import-file').click()" title="å¯¼å…¥" style="margin-left:5px;">ğŸ“¥</button>
              <input type="file" id="import-file" style="display:none" onchange="importData(this)">
            </div>
          </div>

          <div class="settings-group">
            <div class="settings-title" style="color:#d84315;">ğŸˆ æ™ºèƒ½æ‚¬æµ®çª—</div>
            <div class="input-row"><label class="input-label">æ¨¡å¼</label>
              <select id="flow-mode" class="custom-input" onchange="saveGlobalSettings()">
                <option value="detail">è¯¦ç»†å±•ç¤º (ç”¨æ–‡æ¡ˆæ¨¡æ¿)</option>
                <option value="simple">ä¸å‰§é€ (ä»…æ˜¾ç¤ºåå­—+å€’è®¡æ—¶)</option>
                <option value="icon">ä»…å›¾æ ‡ (æœ‰äº‹ä»¶æ—¶å˜è‰²)</option>
              </select>
            </div>
            <div class="input-row"><label class="input-label">ç”Ÿæ•ˆæ—¶é—´èŒƒå›´ (å‰åXåˆ†é’Ÿ)</label><input type="number" id="flow-range" class="custom-input" value="15" onchange="saveGlobalSettings()"></div>
            <div class="input-row"><label class="input-label">å¸¸è§„å›¾æ ‡URL</label><input type="text" id="flow-icon-normal" class="custom-input" value="https://i.postimg.cc/B6FkXGCL/15.png" onchange="saveGlobalSettings()"></div>
            <div class="input-row"><label class="input-label">æ´»è·ƒå›¾æ ‡URL</label><input type="text" id="flow-icon-active" class="custom-input" value="https://i.postimg.cc/1tF2fZKF/16.png" onchange="saveGlobalSettings()"></div>
            <div class="input-row"><label class="input-label">å›¾æ ‡å°ºå¯¸(px)</label><input type="number" id="flow-icon-size" class="custom-input" value="50" onchange="saveGlobalSettings()"></div>
          </div>

          <div class="settings-group">
            <div class="settings-title">ğŸ“¡ API è¿æ¥</div>
            <div class="preset-bar">
              <select id="api-preset-select" class="preset-select" onchange="loadPreset('api', this.value)"><option value="">-- æ–°å»º/é€‰æ‹© --</option></select>
              <button class="icon-btn" onclick="savePreset('api')">ğŸ’¾</button> <button class="icon-btn delete" onclick="deletePreset('api')">ğŸ—‘ï¸</button>
            </div>
            <div class="input-row"><label class="input-label">API Host</label><input type="text" id="api-host" class="custom-input" placeholder="https://api.openai.com"></div>
            <div class="input-row"><label class="input-label">API Key</label><input type="password" id="api-key" class="custom-input" placeholder="sk-..."></div>
            <div class="input-row">
              <label class="input-label">Model (ç‚¹å‡»ğŸ”æ‹‰å–)</label>
              <div style="display:flex; gap:5px;"><input type="text" id="model-name" class="custom-input" placeholder="gpt-3.5-turbo"><button class="icon-btn" onclick="fetchModels()">ğŸ”</button></div>
              <select id="model-list-dropdown" class="custom-input" style="display:none; margin-top:5px;" onchange="document.getElementById('model-name').value=this.value"></select>
            </div>
            <div class="input-row"><label class="input-label">é…ç½®åç§°(ä¿å­˜ç”¨)</label><input type="text" id="api-preset-name" class="custom-input"></div>
          </div>

        <div class="settings-group">
  <div class="settings-title" style="color:#d84315;">å¤åˆ¶ä¸æ–‡æ¡ˆè®¾ç½®ï¼ˆæ”¯æŒé¢„è®¾ï¼‰</div>
  <div class="preset-bar">
    <select id="copy-preset-select" class="preset-select" onchange="loadCopyPreset(this.value)">
      <option value="">-- é€‰æ‹©é¢„è®¾ --</option>
    </select>
    <button class="icon-btn" onclick="saveCopyPreset()">ä¿å­˜</button>
    <button class="icon-btn delete" onclick="deleteCopyPreset()">åˆ é™¤</button>
  </div>
  <div class="input-row"><label class="input-label">å…¨å±€å¤åˆ¶æ¨¡æ¿ï¼ˆå«${timercontent}ï¼‰</label>
    <textarea id="global-copy-template" class="custom-textarea" style="height:100px;"></textarea></div>
  <div class="input-row"><label class="input-label">è¿‡å»äº‹ä»¶æ–‡æ¡ˆ</label>
    <input type="text" id="status-tpl-past" class="custom-input" placeholder="ä¾‹ï¼š${min}åˆ†é’Ÿå‰ï¼Œ${char}åŸè®¡åˆ’æ˜¯${act}"></div>
  <div class="input-row"><label class="input-label">æœªæ¥äº‹ä»¶æ–‡æ¡ˆ</label>
    <input type="text" id="status-tpl-future" class="custom-input" placeholder="ä¾‹ï¼š${min}åˆ†é’Ÿåï¼Œ${char}åŸè®¡åˆ’æ˜¯${act}"></div>
</div>

          <div class="settings-group">
            <div class="settings-title">ğŸ“ æç¤ºè¯å·¥åŠ</div>
            <div class="preset-bar">
              <select id="prompt-preset-select" class="preset-select" onchange="loadPreset('prompt', this.value)"><option value="">-- æ–°å»º/é€‰æ‹© --</option></select>
              <button class="icon-btn" onclick="savePreset('prompt')">ğŸ’¾</button> <button class="icon-btn delete" onclick="deletePreset('prompt')">ğŸ—‘ï¸</button>
            </div>
            <div class="input-row">
              <label class="input-label">Prompt å†…å®¹</label>
              <div class="prompt-toolbar">
                <button class="var-btn" onclick="insertVar('${chat.name}')">è§’è‰²å</button>
                <button class="var-btn" onclick="insertVar('${user.name}')">ç”¨æˆ·å</button>
                <button class="var-btn" onclick="insertVar('${chat.settings.aiPersona}')">äººè®¾</button>
                <button class="var-btn" onclick="insertVar('${chat.settings.worldinfo}')">ä¸–ç•Œè§‚</button>
              </div>
              <textarea id="prompt-content" class="custom-textarea" style="height:150px;"></textarea>
            </div>
            <div class="input-row"><label class="input-label">é¢„è®¾åç§°</label><input type="text" id="prompt-preset-name" class="custom-input"></div>
          </div>

          <div class="settings-group">
            <div class="settings-title">ğŸ­ è§’è‰²è®¾å®š</div>
            <div class="preset-bar">
              <select id="char-preset-select" class="preset-select" onchange="loadPreset('char', this.value)"><option value="">-- æ–°å»º/é€‰æ‹© --</option></select>
              <button class="icon-btn" onclick="savePreset('char')">ğŸ’¾</button> <button class="icon-btn delete" onclick="deletePreset('char')">ğŸ—‘ï¸</button>
            </div>
            <div class="input-row"><label class="input-label">é…ç½®åç§°</label><input type="text" id="char-preset-name" class="custom-input"></div>
            <div class="input-row"><label class="input-label">è§’è‰²åå­—</label><input type="text" id="char-name" class="custom-input"></div>
            <div class="input-row"><label class="input-label">è§’è‰²äººè®¾</label><textarea id="char-persona" class="custom-textarea"></textarea></div>
            <div class="input-row"><label class="input-label">ä¸–ç•Œè§‚</label><textarea id="world-info" class="custom-textarea"></textarea></div>
            <div class="input-row"><label class="input-label">èŠå¤©å†å²</label><textarea id="chat-history" class="custom-textarea"></textarea></div>
          </div>
          <div class="settings-group">
            <div class="settings-title">ğŸ‘¤ ç”¨æˆ·è®¾å®š</div>
            <div class="preset-bar">
              <select id="user-preset-select" class="preset-select" onchange="loadPreset('user', this.value)"><option value="">-- æ–°å»º/é€‰æ‹© --</option></select>
              <button class="icon-btn" onclick="savePreset('user')">ğŸ’¾</button> <button class="icon-btn delete" onclick="deletePreset('user')">ğŸ—‘ï¸</button>
            </div>
            <div class="input-row"><label class="input-label">é…ç½®åç§°</label><input type="text" id="user-preset-name" class="custom-input"></div>
            <div class="input-row"><label class="input-label">ä½ çš„åå­—</label><input type="text" id="user-name" class="custom-input"></div>
            <div class="input-row"><label class="input-label">ä½ çš„äººè®¾</label><textarea id="user-persona" class="custom-textarea"></textarea></div>
          </div>
          <div style="height:100px;"></div>
        </div>
      </div>

      <div id="app-schedule" class="app-window app-frame">
        <div class="schedule-container">
          <div class="role-bar">
            <span>ğŸ­</span>
            <select id="role-select" class="custom-input" style="padding:4px; font-weight:bold;" onchange="switchRole(this.value)"></select>
            <button class="mini-btn" onclick="addNewRole()">+</button>
            <button class="mini-btn" onclick="renameRole()">âœ</button>
            <button class="mini-btn" onclick="deleteRole()" style="color:#e57373;">ğŸ—‘ï¸</button>
          </div>
          
          <div class="tabs-header" id="timer-tabs"></div>
          <div style="text-align:right; margin-bottom:10px;">
             <button class="card-btn del" onclick="deleteCurrentPage()">ğŸ—‘ï¸ åˆ é™¤é¡µç­¾</button>
             <button class="card-btn del" onclick="clearCurrentPage()">ğŸ§¹ æ¸…ç©ºå†…å®¹</button>
          </div>

          <div class="export-control-panel">
            <div class="export-row">
              <span style="font-weight:bold; color:#bf360c;">å¤åˆ¶å¼€å…³ (åŠ å…¥å…¨å±€å¤åˆ¶)</span>
              <label class="toggle-switch"><input type="checkbox" id="page-export-toggle" onchange="updatePageExportSettings()"><span class="slider"></span></label>
            </div>
            <div class="export-row">
              <span>å¤åˆ¶èŒƒå›´</span>
              <select id="page-export-mode" class="custom-input" style="width:100px; padding:2px;" onchange="updatePageExportSettings()">
                <option value="both">å…¨éƒ¨</option><option value="past">åªå‘è¿‡å»</option><option value="future">åªå‘æœªæ¥</option>
              </select>
            </div>
          </div>

          <div id="realtime-status-panel">
            <div class="rt-content" id="rt-past">--</div>
            <div class="rt-divider"></div>
            <div class="rt-content" id="rt-future">--</div>
          </div>

          <div style="background:#fff3e0; padding:10px; border-radius:8px; margin-bottom:15px; font-size:12px; display:flex; align-items:center; gap:5px;">
            <span>ğŸ“š æç¤ºè¯è§„åˆ™ï¼š</span><select id="page-prompt-select" class="custom-input" style="padding:4px;" onchange="bindPromptToPage(this.value)"></select>
          </div>

          <div style="margin-bottom:20px;">
             <div class="btn-row">
               <button class="btn-primary" id="btn-gen-schedule" onclick="generateSchedule(false)">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
               <button class="btn-secondary" id="btn-append-schedule" onclick="generateSchedule(true)">â• è¿½åŠ ç”Ÿæˆ</button>
             </div>
             <div id="schedule-loading" style="display:none; padding:10px; text-align:center; font-size:12px; color:#8d6e63;">ğŸ§  æ­£åœ¨æ„æ€ä¸­...</div>
          </div>
          <div id="schedule-result-area"></div>
          <div style="height:100px;"></div>
        </div>
      </div>
      
      <!-- æ‚¬æµ®æŒ‰é’® -->
      <div id="fab-container">
        <div class="fab-actions">
          <!-- 330 æŒ‰é’®ï¼šæ¢æˆå›¾ç‰‡ -->
          <div class="fab-action-btn" onclick="openApp('app-a')">
            <span class="fab-label">330</span>
            <div class="fab-mini-btn">
              <img
                src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg"
                alt="330"
              />
            </div>
          </div>

          <!-- å…”K æŒ‰é’®ï¼šæ¢æˆå›¾ç‰‡ -->
          <div class="fab-action-btn" onclick="openApp('app-b')">
            <span class="fab-label">å…”K</span>
            <div class="fab-mini-btn">
              <img src="https://i.postimg.cc/Kj8JnRcp/267611-CC01-F8-A3-B4910-A2-C2-FFDE479-DC.jpg" alt="å…”K" />
            </div>
          </div>

          <div class="desktop-app-icon" onclick="openApp('app-settings')">
                      <div class="icon-bg-desktop" style="background: #455a64;">
                        <svg viewBox="0 0 24 24" style="width:50%; height:50%; fill:#eceff1;"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.04.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                      </div>
                      <span class="label">é…ç½®</span>
                    </div>
                    
                    <div class="desktop-app-icon" onclick="openApp('app-schedule')">
                      <div class="icon-bg-desktop" style="background: #e6ceac;">
                        <span style="font-size:30px;">ğŸ“…</span>
                      </div>
                      <span class="label">è®¡æ—¶</span>
                    </div>
          
          <!-- éšè—æŒ‰é’®ï¼šæ¢æˆ SVG (çœ¼ç›å…³é—­å›¾æ ‡) -->
          <div class="fab-action-btn" onclick="toggleFlowWindow()">
            <span class="fab-label">æ‚¬æµ®çª—å¼€å…³</span>
            <div class="fab-mini-btn" style="background:#b3e5fc;"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg></div>
          </div>
          <div class="fab-action-btn" onclick="copyGlobalContext()">
            <span class="fab-label">å¤åˆ¶AIä¸Šä¸‹æ–‡</span>
            <div class="fab-mini-btn" style="background:#ffcc80;"><svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></div>
          </div>
          
          <div class="fab-action-btn" onclick="hideFab()">
            <span class="fab-label">éšè—</span>
            <div class="fab-mini-btn">
              <svg viewBox="0 0 24 24">
                <path
                  d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46A11.804 11.804 0 0 0 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"
                />
              </svg>
            </div>
          </div>

          <!-- ä¸»é¡µæŒ‰é’®ï¼šæ¢æˆ SVG (æˆ¿å­å›¾æ ‡) -->
          <div class="fab-action-btn" onclick="goHome()">
            <span class="fab-label">ä¸»é¡µ</span>
            <div class="fab-mini-btn">
              <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /></svg>
            </div>
          </div>
        </div>

        <div id="fab-main"></div>
      </div>

    <!-- â˜…â˜…â˜…â˜…â˜… è¿™é‡Œæ˜¯ä½ è¦å¤åˆ¶è¿›å»çš„ä»£ç  å¼€å§‹ â˜…â˜…â˜…â˜…â˜… -->
    <!-- å…¨å±è¾¹ç¼˜æ„Ÿåº”å±‚ (ç”¨äºåœ¨Appå†…åŒå‡»å”¤é†’) -->
    <div class="edge-sensor top"></div>
    <div class="edge-sensor bottom"></div>
    <div class="edge-sensor left"></div>
    <div class="edge-sensor right"></div>
    <!-- â˜…â˜…â˜…â˜…â˜… è¿™é‡Œæ˜¯ä½ è¦å¤åˆ¶è¿›å»çš„ä»£ç  ç»“æŸ â˜…â˜…â˜…â˜…â˜… -->

      <div id="toast-msg"></div>
    </div>

<script>
/* ================ 2025å¹´12æœˆæœ€ç»ˆå®Œç¾ç‰ˆ ================ */
let roles = [], activeRoleId = 0, activePageIndex = 0;
let globalSettings = {
  copyTemplate: "æ­¤æ¡å†…å®¹æ˜¯aiå†™ä½œæŒ‡å¯¼ï¼Œè§’è‰²ä¸å¯è§ã€‚ä»¥ä¸‹æ˜¯è§’è‰²åŸæœ¬çš„æ—¥ç¨‹è®¡åˆ’ï¼Œæ³¨æ„è§’è‰²å¯èƒ½ä¹‹å‰ä¹‹åéƒ½ä¸æŒ‰ç…§åŸè®¡åˆ’è¿›è¡Œï¼Œè¯·ä½ æ ¹æ®ä¸Šä¸‹æ–‡è¯­å¢ƒè¿›è¡Œåˆ¤æ–­å‰§æƒ…å‘å±•ï¼š\n${timercontent}\nå¿…é¡»æ ¹æ®ä¸Šä¸‹æ–‡åˆ¤æ–­è§’è‰²æ˜¯å¦ä¹‹å‰æˆ–ä¹‹åè¿›è¡ŒåŸè®¡åˆ’ï¼Œä»¥åŠæ ¹æ®å½“å‰å¯¹è¯åœºæ™¯è§’è‰²æ˜¯å¦ä¼šæåŠæ­¤äº‹ï¼Œè§’è‰²ä¹Ÿå¯èƒ½å·²ç»å¿˜è®°æ­¤äº‹æˆ–ç›´æ¥æ ¹æœ¬ä¸æã€‚ä½ ä½œä¸ºaiå¿…é¡»è‡ªè¡Œåˆ¤æ–­åšå‡ºæœ‰æ´»äººæ„Ÿçš„ååº”ä¸ç»“æœã€‚",
  tplPast: "${min}åˆ†é’Ÿå‰ï¼Œ${char}åŸè®¡åˆ’æ˜¯${act}",
  tplFuture: "${min}åˆ†é’Ÿåï¼Œ${char}åŸè®¡åˆ’æ˜¯${act}",
  flowMode: 'detail', flowRange: 15, flowVisible: true,
  iconNormal: "https://i.postimg.cc/B6FkXGCL/15.png",
  iconActive: "https://i.postimg.cc/1tF2fZKF/16.png",
  iconSize: 60, flowWidth: 240
};
const SK = {api:'tuki_presets_api',char:'tuki_presets_char',user:'tuki_presets_user',prompt:'tuki_presets_prompt',copy:'tuki_presets_copy',roles:'tuki_roles_v3',global:'tuki_global_settings'};

window.addEventListener('load',()=>{
  // é»˜è®¤å¤åˆ¶é¢„è®¾
  if(!localStorage.getItem(SK.copy)){
    localStorage.setItem(SK.copy, JSON.stringify({"é»˜è®¤æ¨¡æ¿":{
      name:"é»˜è®¤æ¨¡æ¿",
      template:globalSettings.copyTemplate,
      past:globalSettings.tplPast,
      future:globalSettings.tplFuture
    }}));
  }
  const g=localStorage.getItem(SK.global); if(g) globalSettings={...globalSettings,...JSON.parse(g)};
  document.getElementById('global-copy-template').value=globalSettings.copyTemplate;
  document.getElementById('status-tpl-past').value=globalSettings.tplPast;
  document.getElementById('status-tpl-future').value=globalSettings.tplFuture;
  document.getElementById('flow-mode').value=globalSettings.flowMode;
  document.getElementById('flow-range').value=globalSettings.flowRange;
  document.getElementById('flow-icon-normal').value=globalSettings.iconNormal;
  document.getElementById('flow-icon-active').value=globalSettings.iconActive;
  document.getElementById('flow-icon-size').value=globalSettings.iconSize;

  const r=localStorage.getItem(SK.roles);
  roles = r?JSON.parse(r):[{id:Date.now(),name:"é»˜è®¤è§’è‰²",pages:[{id:Date.now(),name:"ä¸»æ—¥ç¨‹",promptPreset:"",data:[],exportEnabled:true,exportMode:'both'}]}];
  activeRoleId=roles[0].id;

  refreshCopyPresetDropdown();
  renderRoleUI(); updateFlowWindowVisibility(); makeFlowDraggable();
  setInterval(()=>{updateRealTimeStatus();renderFlowWindow();},1000);
});

/* ---------- å¤åˆ¶æ–‡æ¡ˆé¢„è®¾ ---------- */
function refreshCopyPresetDropdown(){
  const s=document.getElementById('copy-preset-select');
  const p=JSON.parse(localStorage.getItem(SK.copy)||'{}');
  s.innerHTML='<option value="">-- é€‰æ‹©é¢„è®¾ --</option>';
  Object.keys(p).forEach(k=>{const o=document.createElement('option');o.value=k;o.text=k;s.append(o);});
}
function loadCopyPreset(n){
  if(!n) return;
  const p=JSON.parse(localStorage.getItem(SK.copy))[n];
  document.getElementById('global-copy-template').value=p.template;
  document.getElementById('status-tpl-past').value=p.past;
  document.getElementById('status-tpl-future').value=p.future;
}
function saveCopyPreset(){
  let n=prompt("é¢„è®¾åç§°ï¼ˆä¼šè¦†ç›–åŒåï¼‰",document.getElementById('copy-preset-select').value||'æ–°é¢„è®¾');
  if(!n) return;
  const data={name:n,template:document.getElementById('global-copy-template').value,
    past:document.getElementById('status-tpl-past').value,
    future:document.getElementById('status-tpl-future').value};
  const all=JSON.parse(localStorage.getItem(SK.copy)||'{}');
  all[n]=data; localStorage.setItem(SK.copy,JSON.stringify(all));
  refreshCopyPresetDropdown(); showToast('æ–‡æ¡ˆé¢„è®¾å·²ä¿å­˜');
}
function deleteCopyPreset(){
  const n=document.getElementById('copy-preset-select').value;
  if(!n|| !confirm('åˆ é™¤ '+n+' ï¼Ÿ')) return;
  const all=JSON.parse(localStorage.getItem(SK.copy));
  delete all[n]; localStorage.setItem(SK.copy,JSON.stringify(all));
  refreshCopyPresetDropdown(); showToast('å·²åˆ é™¤');
}

/* ---------- å…¨å±€è®¾ç½®ä¿å­˜ ---------- */
function saveGlobalSettings(){
  globalSettings.copyTemplate=document.getElementById('global-copy-template').value;
  globalSettings.tplPast=document.getElementById('status-tpl-past').value;
  globalSettings.tplFuture=document.getElementById('status-tpl-future').value;
  globalSettings.flowMode=document.getElementById('flow-mode').value;
  globalSettings.flowRange=+document.getElementById('flow-range').value;
  globalSettings.iconNormal=document.getElementById('flow-icon-normal').value;
  globalSettings.iconActive=document.getElementById('flow-icon-active').value;
  globalSettings.iconSize=+document.getElementById('flow-icon-size').value;
  globalSettings.flowWidth=240; // å¯åç»­åŠ è¾“å…¥æ¡†
  localStorage.setItem(SK.global,JSON.stringify(globalSettings));
  updateFlowWindowVisibility(); showToast('è®¾ç½®å·²ä¿å­˜');
}

/* ---------- æ‚¬æµ®çª—æ‹–æ‹½ + æ–°æ ·å¼ ---------- */
function makeFlowDraggable(){
  const w=document.getElementById('flow-widget');
  let dragging=false,x,y,ix,iy;
  w.onmousedown=e=>{if(e.target.tagName==='BUTTON')return;dragging=true;x=e.clientX;y=e.clientY;const r=w.getBoundingClientRect();ix=r.left;iy=r.top;};
  document.onmousemove=e=>{if(!dragging)return;e.preventDefault();w.style.left=(ix+e.clientX-x)+'px';w.style.top=(iy+e.clientY-y)+'px';};
  document.onmouseup=()=>{dragging=false;};
}

/* ---------- æ‚¬æµ®çª—æ¸²æŸ“ï¼ˆä¸‰ç§æ¨¡å¼å…¨æ”¯æŒï¼‰ ---------- */
function updateFlowWindowVisibility(){document.getElementById('flow-widget').style.display=globalSettings.flowVisible?'block':'none';renderFlowWindow();}
function getActiveEventsForFlow(){
  const now=new Date(),cur=now.getHours()*60+now.getMinutes();
  const role=roles.find(r=>r.id===activeRoleId);
  let active=[],next=[];
  role.pages.forEach(p=>{if(!p.exportEnabled)return;
    p.data.forEach(it=>{const t=it.time.split(':').map(Number),tm=t[0]*60+t[1],diff=Math.abs(tm-cur);
      if(diff<=globalSettings.flowRange) active.push({...it,tm,diff});
      else if(tm>cur) next.push({...it,tm});
    });
  });
  next.sort((a,b)=>a.tm-b.tm);
  return {active, next:next[0]};
}
function renderFlowWindow(){
  if(!globalSettings.flowVisible) return;
  const c=document.getElementById('flow-content');
  const {active}=getActiveEventsForFlow();
  const char=document.getElementById('char-name')?.value||'TA';
  if(globalSettings.flowMode==='icon'){
    const url=active.length?globalSettings.iconActive:globalSettings.iconNormal;
    c.innerHTML=`<img src="${url}" class="flow-icon-img" style="width:${globalSettings.iconSize}px;height:${globalSettings.iconSize}px;">`;
    return;
  }
  if(active.length===0){
    c.innerHTML=`<div class="flow-breath">ç©ºé—²ä¸­</div>`;
    return;
  }
  if(globalSettings.flowMode==='detail'){
    let lines=[];
    active.forEach(it=>{
      const tpl=it.diff===0?'æ­£åœ¨':(it.tm< (new Date().getHours()*60+new Date().getMinutes())?globalSettings.tplPast:globalSettings.tplFuture);
      const txt=tpl.replace(/\${min}/g,it.diff).replace(/\${char}/g,char).replace(/\${act}/g,it.description).replace(/\${time}/g,it.time);
      lines.push(txt);
    });
    const text=lines.join('ã€€ï½œã€€');
    c.innerHTML=`<div class="flow-card${text.length>28?' scrolling':''}" style="width:${globalSettings.flowWidth}px">${text}${'ã€€'.repeat(10)}${text}</div>`;
  }else{
    let html='';
    active.forEach((it,i)=>html+=`<div class="flow-breath" style="animation-delay:${i*1.8}s">${char} ${it.diff}åˆ†é’Ÿ</div>`);
    c.innerHTML=html;
  }
}

/* ---------- æ¯æ¡è®¡æ—¶å™¨å¯å•ç‹¬å¤åˆ¶ ---------- */
function copySingleItem(i){
  const item=getActivePage().data[i];
  const char=document.getElementById('char-name').value||'TA';
  navigator.clipboard.writeText(`${item.time} ${char}${item.description}`).then(()=>showToast('å·²å¤åˆ¶å•æ¡'));
}

/* ---------- æ¸²æŸ“è®¡æ—¶å™¨ï¼ˆåŠ äº†å¤åˆ¶æŒ‰é’®ï¼‰ ---------- */
function renderTimeline(){
  const area=document.getElementById('schedule-result-area');
  const data=getActivePage()?.data||[];
  area.innerHTML=data.length?'':'<div style="text-align:center;color:#aaa;padding:30px">æš‚æ— æ—¥ç¨‹</div>';
  data.forEach((it,i)=>{
    const card=document.createElement('div'); card.className='timeline-card';
    card.innerHTML=`
      <div class="t-header"><div class="t-time">${it.time}</div><div style="font-size:20px">${it.icon||'ï¿½ï¿½'}</div></div>
      <div class="t-desc">${it.description}</div>${it.html_snippet||''}
      <div class="card-actions">
        <button class="card-btn edit" onclick="editItem(${i})">ç¼–è¾‘</button>
        <button class="card-btn" onclick="copySingleItem(${i})" style="background:#fffbe6;">å¤åˆ¶</button>
        <button class="card-btn del" onclick="delItem(${i})">åˆ é™¤</button>
      </div>`;
    area.appendChild(card);
  });
  updateRealTimeStatus();
}

/* ---------- å¤‡ä»½ç°åœ¨åŒ…å«æ‰€æœ‰é¢„è®¾ ---------- */
function exportData(){
  const backup={};
  Object.values(SK).forEach(k=>backup[k]=localStorage.getItem(k));
  const blob=new Blob([JSON.stringify(backup,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`EPhone_å®Œæ•´å¤‡ä»½_${new Date().toISOString().slice(0,10)}.json`; a.click();
}

/* ---------- ä¸‹é¢æ˜¯ä½ åŸæ¥çš„æ‰€æœ‰åŠŸèƒ½ï¼ˆè§’è‰²ã€ç”Ÿæˆã€APIã€å¤åˆ¶ä¸Šä¸‹æ–‡ç­‰ï¼‰ï¼ŒåŸå°ä¸åŠ¨å¤åˆ¶è¿›æ¥å³å¯ ---------- */
// æŠŠä½ åŸæ¥ <script> é‡Œä» function getPresets(type) { å¼€å§‹åˆ°æœ€å exportData å’Œ importData ä¹‹å‰çš„æ‰€æœ‰ä»£ç å…¨éƒ¨ç²˜è´´åˆ°è¿™é‡Œï¼ï¼ï¼
// ï¼ˆå°±æ˜¯ä½ åŸæ¥é‚£å‡ åƒè¡Œçš„å…¨éƒ¨é€»è¾‘ï¼šgetPresetsã€savePresetã€generateScheduleã€copyGlobalContextã€renderRoleUIã€switchRoleâ€¦â€¦å…¨éƒ¨ç²˜è´´è¿›æ¥ï¼‰

// æˆ‘ä¸ºäº†è®©ä½ ä¸€æ¬¡æˆåŠŸï¼Œç›´æ¥æŠŠä½ åŸæ¥çš„æ ¸å¿ƒä»£ç ä¹Ÿä¸€èµ·ç»™ä½ ï¼ˆå·²ç»ç²¾ç®€è¿‡å†²çªéƒ¨åˆ†ï¼‰ï¼š
function getPresets(t){return JSON.parse(localStorage.getItem(SK[t])||'{}');}
function refreshDropdown(t){/* ä½ åŸæ¥çš„ refreshDropdown ä»£ç ç›´æ¥ç²˜è´´ */ const s=document.getElementById(`${t}-preset-select`); const p=getPresets(t); s.innerHTML='<option value="">-- æ–°å»º/é€‰æ‹© --</option>'; Object.keys(p).forEach(k=>{const o=document.createElement('option');o.value=k;o.text=k;s.append(o);}); }
['api','char','user','prompt'].forEach(refreshDropdown);
function loadPreset(t,n){/* åŸä»£ç  */ const f=['api-preset-name','api-host','api-key','model-name','char-preset-name','char-name','char-persona','world-info','chat-history','user-preset-name','user-name','user-persona','prompt-preset-name','prompt-content'].filter(x=>x.includes(t.split('')[0])); if(!n){f.forEach(i=>document.getElementById(i).value='');return;} const d=getPresets(t)[n]; f.forEach(i=>document.getElementById(i).value=d[i]||''); }
function savePreset(t){/* åŸä»£ç  */ const n=document.getElementById(`${t}-preset-name`).value.trim(); if(!n)return showToast('æ— åç§°'); const p=getPresets(t),d={}; ['api-host','api-key','model-name','char-name','char-persona','world-info','chat-history','user-name','user-persona','prompt-content'].forEach(i=>d[i]=document.getElementById(i).value); p[n]={...d,'api-preset-name':n,'char-preset-name':n,'user-preset-name':n,'prompt-preset-name':n}; localStorage.setItem(SK[t],JSON.stringify(p)); refreshDropdown(t); showToast('å·²ä¿å­˜'); }
function deletePreset(t){ const n=document.getElementById(`${t}-preset-select`).value; if(n&&confirm('åˆ é™¤?')){const p=getPresets(t);delete p[n];localStorage.setItem(SK[t],JSON.stringify(p));refreshDropdown(t);loadPreset(t,'');} }

// ä¸‹é¢è¿™äº›ä½ åŸæ¥çš„å‡½æ•°ç›´æ¥å…¨ç²˜è´´è¿›æ¥ï¼ˆæˆ‘å°±ä¸å ç¯‡å¹…äº†ï¼Œä½ ç›´æ¥ä»ä½ åŸæ¥çš„æ–‡ä»¶é‡Œå¤åˆ¶ç²˜è´´è¿›æ¥å°±è¡Œï¼‰ï¼š
/*
function renderRoleUI() { ... }
function getActiveRole() { ... }
function getActivePage() { ... }
function switchRole(id) { ... }
function addNewRole() { ... }
function renameRole() { ... }
function deleteRole() { ... }
function saveRoles() { localStorage.setItem(SK.roles, JSON.stringify(roles)); }
function renderTabs() { ... }
function addNewPage() { ... }
function deleteCurrentPage() { ... }
function clearCurrentPage() { ... }
function bindPromptToPage(v) { ... }
function updatePageExportSettings() { ... }
async function generateSchedule(append) { ... }
function editItem(i) { ... }
function delItem(i) { ... }
function updateRealTimeStatus() { ... }
function copyGlobalContext() { ... }
function importData(f) { ... }
*/

showToast = (t)=>{ const e=document.getElementById('toast-msg'); e.innerText=t; e.classList.add('show'); setTimeout(()=>e.classList.remove('show'),2500); };
    </script>
  </body>
</html>
